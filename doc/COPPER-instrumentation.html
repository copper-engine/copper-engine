<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<title>Copper Continuation by Instrumentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
    margin-bottom: 1.25em;
}

.tablist > ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
}

.tablist > ul li {
    align-items: center;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    font-weight: bold;
    line-height: 1.5;
    padding: 0.25em 1em;
    position: relative;
}

.tablist > ul li:focus-visible {
    outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
    margin: 0;
}

.tablist.ulist > ul li + li {
    margin-left: 0.25em;
}

.tabs .tablist li::after {
    content: "";
    display: block;
    height: 1px;
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
    background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
    background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
    line-height: inherit;
    margin: 0;
}

.tabpanel {
    background-color: #fff;
    padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
    border: 1px solid #dcdcdc;
}

.tablist > ul li {
    border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
    display: none;
}

.tabpanel > :first-child {
    margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
    margin-bottom: 0;
}

.tablecontainer {
    overflow-x: auto;
}

#content .tablecontainer {
    margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
    margin-bottom: 0;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Copper Continuation by Instrumentation</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This documentation should help to understand the implementation of
<a href="https://en.wikipedia.org/wiki/Continuation">continuations</a> in the <a href="https://copper-engine.org/">COPPER Engine</a> Workflows.</p>
</div>
<div class="paragraph">
<p>COPPER Workflows can be interrupted and continued by using several methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>savepoint</code></p>
</li>
<li>
<p><code>wait</code></p>
</li>
<li>
<p><code>waitForAll</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following examples <code>savepoint</code> is used, but the concept is the same for the other methods.</p>
</div>
<div class="paragraph">
<p>Continuation is realized by using instrumentation with the <a href="https://asm.ow2.io/">ASM Framework</a>.
Here we start with analyzing a <a href="#OneSavepoint">first simple Workflow</a> and a <a href="#SavepointsAndSubWorkflows">second more complex Workflow</a>.
Then we visit some <a href="#Implementation">Implementation</a> details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="OneSavepoint">Example with one Savepoint</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_original_workflow">The original Workflow</h3>
<div class="paragraph">
<p>This is the original Workflow with correct Java code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">test</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Interrupt</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Workflow</span>;

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">OneSavepoint</span> <span style="color:#088;font-weight:bold">extends</span> Workflow&lt;<span style="color:#0a8;font-weight:bold">Void</span>&gt; {

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> main() <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#339;font-weight:bold">int</span> i1 = <span style="color:#00D">1</span>;
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> i2 = <span style="color:#00D">2</span>;
        savepoint(); // <b class="conum">(1)</b>
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>);
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>savepoint</code> in line 13.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the main method it called the 1st time, the code up to the savepoint will be run.
Then the execution will be stopped until a 2nd call of the method will run the code up to its end.
How this is realized, the following chapters should explain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_decompiled_instrumented_workflow">The decompiled instrumented Workflow</h3>
<div class="paragraph">
<p>This is the instrumented Workflow with incorrect Java code, generated by a decompiler.
Nevertheless, it helps to understand more of the COPPER internals.
In the following chapters we dive into the byte code, that holds the truth.</p>
</div>
<div class="paragraph">
<p>Keep in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>main</code> method has no parameters.</p>
</li>
<li>
<p>The <code>Workflow</code> has two imported COPPER internal members <code>__stack</code> and <code>__stackPosition</code> using in the conditions.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre><span style="color:#777">//</span>
<span style="color:#777">// Source code recreated from a .class file by IntelliJ IDEA</span>
<span style="color:#777">// (powered by Fernflower decompiler)</span>
<span style="color:#777">//</span>

<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">test</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Interrupt</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.StackEntry</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Workflow</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.instrument.Transformed</span>;

<span style="color:#007">@Transformed</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">OneSavepoint</span> <span style="color:#088;font-weight:bold">extends</span> Workflow&lt;<span style="color:#0a8;font-weight:bold">Void</span>&gt; {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> main() <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.__stack.size() == <span style="color:#950">this</span>.__stackPosition) { // <b class="conum">(1)</b>
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#339;font-weight:bold">int</span> i1 = <span style="color:#00D">1</span>;
            <span style="color:#339;font-weight:bold">int</span> i2 = <span style="color:#00D">2</span>;
            <span style="color:#950">this</span>.savepoint();
            <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">0</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, i2})); // <b class="conum">(2)</b>
            ++<span style="color:#950">this</span>.__stackPosition; // <b class="conum">(3)</b>
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt(); // <b class="conum">(4)</b>
        } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).jumpNo == <span style="color:#00D">0</span>) { // <b class="conum">(5)</b>
            <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var10000 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals; // <b class="conum">(6)</b>
            <span style="color:#950">this</span> = (OneSavepoint)var10000[<span style="color:#00D">0</span>]; // <b class="conum">(7)</b>
            <span style="color:#339;font-weight:bold">int</span> i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var10000[<span style="color:#00D">1</span>]; // <b class="conum">(8)</b>
            <span style="color:#339;font-weight:bold">int</span> i2 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var10000[<span style="color:#00D">2</span>]; // <b class="conum">(9)</b>
            ++<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#950">this</span>.__stack.pop(); // <b class="conum">(10)</b>
            --<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>);
        } <span style="color:#080;font-weight:bold">else</span> {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>);
        }
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Condition is <code>true</code> for first call</p>
</li>
<li>
<p>Storing <code>StackEntry</code> to <code>__stack</code> (no call stack parameters, jumpNo=0 and locals)</p>
</li>
<li>
<p>Confusion and irrelevant increment of <code>__stackPosition</code></p>
</li>
<li>
<p>End of first call</p>
</li>
<li>
<p>Condition is <code>true</code> for second call</p>
</li>
<li>
<p>Get <code>locals</code> to restore local variables</p>
</li>
<li>
<p>Assignment to <code>this</code> in line 26 is invalid</p>
</li>
<li>
<p>Restore <code>i1</code></p>
</li>
<li>
<p>Restore <code>i2</code></p>
</li>
<li>
<p>Removing <code>StackEntry</code> from top of <code>__stack</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We see the original code embedded in conditional enhanced scopes.</p>
</div>
<div class="paragraph">
<p>It is important to know, that</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>__stack</code> is stored in COPPER after the calls (may be empty)</p>
</li>
<li>
<p><code>__stack</code> is used for next call</p>
</li>
<li>
<p><code>__stackPosition</code> is not stored.
It is <code>0</code> each time the <code>main</code> is called</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_byte_code_of_the_original_workflow">The byte code of the original Workflow</h3>
<div class="paragraph">
<p>Our first Java byte code assembly belongs to the original Workflow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td>
  <td class="code"><pre><span style="color:#777">// class version 61.0 (61)</span>
<span style="color:#777">// access flags 0x21</span>
<span style="color:#777">// signature Lorg/copperengine/core/Workflow&lt;Ljava/lang/Void;&gt;;</span>
<span style="color:#777">// declaration: test/OneSavepoint extends org.copperengine.core.Workflow&lt;java.lang.Void&gt;</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">test</span>/OneSavepoint <span style="color:#088;font-weight:bold">extends</span> org/copperengine/core/Workflow {

  <span style="color:#777">// compiled from: OneSavepoint.java</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> &lt;init&gt;()V // <b class="conum">(1)</b>
   L0
    LINENUMBER <span style="color:#00D">6</span> L0
    ALOAD <span style="color:#00D">0</span>
    INVOKESPECIAL org/copperengine/core/Workflow.&lt;init&gt; ()V
    RETURN
   L1
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepoint; L0 L1 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">1</span>
    MAXLOCALS = <span style="color:#00D">1</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> main()V <span style="color:#088;font-weight:bold">throws</span> org/copperengine/core/Interrupt // <b class="conum">(2)</b>
   L0
    LINENUMBER <span style="color:#00D">10</span> L0
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L1
    LINENUMBER <span style="color:#00D">11</span> L1
    ICONST_1
    ISTORE <span style="color:#00D">1</span>
   L2
    LINENUMBER <span style="color:#00D">12</span> L2
    ICONST_2
    ISTORE <span style="color:#00D">2</span>
   L3
    LINENUMBER <span style="color:#00D">13</span> L3
    ALOAD <span style="color:#00D">0</span>
    INVOKEVIRTUAL test/OneSavepoint.savepoint ()V // <b class="conum">(3)</b>
   L4
    LINENUMBER <span style="color:#00D">14</span> L4
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L5
    LINENUMBER <span style="color:#00D">15</span> L5
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L6
    LINENUMBER <span style="color:#00D">16</span> L6
    RETURN
   L7
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepoint; L0 L7 <span style="color:#00D">0</span>
    LOCALVARIABLE i1 I L2 L7 <span style="color:#00D">1</span>
    LOCALVARIABLE i2 I L3 L7 <span style="color:#00D">2</span>
    MAXSTACK = <span style="color:#00D">2</span>
    MAXLOCALS = <span style="color:#00D">3</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Irrelevant constructor <code>init</code></p>
</li>
<li>
<p>Relevant `main`method</p>
</li>
<li>
<p>The <code>savepoint</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you often use Java code and no byte code, you also can understand it without all details.
You can see the original <code>LINENUMBER</code> lines, connected to label L1, L2, &#8230;&#8203;
The <code>LDC</code> lines holds string, you also find in Java the code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_byte_code_of_the_instrumented_workflow">The byte code of the instrumented Workflow</h3>
<div class="paragraph">
<p>As we have seen the Java byte code assembly belonging to the original Workflow, we can now look into the instrumented.
It is harder to understand, than the decompiled Java code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
</pre></td>
  <td class="code"><pre><span style="color:#777">// class version 61.0 (61)</span>
<span style="color:#777">// access flags 0x21</span>
<span style="color:#777">// signature Lorg/copperengine/core/Workflow&lt;Ljava/lang/Void;&gt;;</span>
<span style="color:#777">// declaration: test/OneSavepoint extends org.copperengine.core.Workflow&lt;java.lang.Void&gt;</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">test</span>/OneSavepoint <span style="color:#088;font-weight:bold">extends</span> org/copperengine/core/Workflow {

  <span style="color:#777">// compiled from: OneSavepoint.java</span>

  <span style="color:#007">@Lorg</span>/copperengine/core/instrument/Transformed;()

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> &lt;init&gt;()V
   L0
    LINENUMBER <span style="color:#00D">6</span> L0
    ALOAD <span style="color:#00D">0</span>
    INVOKESPECIAL org/copperengine/core/Workflow.&lt;init&gt; ()V
    RETURN
   L1
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepoint; L0 L1 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">1</span>
    MAXLOCALS = <span style="color:#00D">1</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> main()V <span style="color:#088;font-weight:bold">throws</span> org/copperengine/core/Interrupt
    GOTO L0 // <b class="conum">(1)</b>
   L1 // <b class="conum">(2)</b>
    LINENUMBER <span style="color:#00D">10</span> L1
   FRAME SAME
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L2
    LINENUMBER <span style="color:#00D">11</span> L2
    ICONST_1
    ISTORE <span style="color:#00D">1</span>
   L3
    LINENUMBER <span style="color:#00D">12</span> L3
    ICONST_2
    ISTORE <span style="color:#00D">2</span>
   L4
    LINENUMBER <span style="color:#00D">13</span> L4
    ALOAD <span style="color:#00D">0</span>
    INVOKEVIRTUAL test/OneSavepoint.savepoint ()V // <b class="conum">(3)</b>
    SIPUSH <span style="color:#00D">0</span>
    ANEWARRAY java/lang/<span style="color:#0a8;font-weight:bold">Object</span>
    NEW org/copperengine/core/StackEntry // <b class="conum">(4)</b>
    DUP_X1
    DUP_X1
    POP
    SIPUSH <span style="color:#00D">0</span>
    SIPUSH <span style="color:#00D">3</span>
    ANEWARRAY java/lang/<span style="color:#0a8;font-weight:bold">Object</span>
    DUP
    SIPUSH <span style="color:#00D">0</span>
    ALOAD <span style="color:#00D">0</span>
    AASTORE
    DUP
    SIPUSH <span style="color:#00D">1</span>
    ILOAD <span style="color:#00D">1</span>
    INVOKESTATIC java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.valueOf (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Integer</span>;
    AASTORE
    DUP
    SIPUSH <span style="color:#00D">2</span>
    ILOAD <span style="color:#00D">2</span>
    INVOKESTATIC java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.valueOf (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Integer</span>;
    AASTORE
    INVOKESPECIAL org/copperengine/core/StackEntry.&lt;init&gt; ([Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;I[Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;)V
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    SWAP
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.push (Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepoint.__stackPosition : I
    ICONST_1
    IADD
    PUTFIELD test/OneSavepoint.__stackPosition : I
    NEW org/copperengine/core/Interrupt
    DUP
    INVOKESPECIAL org/copperengine/core/Interrupt.&lt;init&gt; ()V
    ATHROW
   L5 // <b class="conum">(5)</b>
   FRAME APPEND [I I]
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.pop ()Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepoint.__stackPosition : I
    ICONST_1
    ISUB
    PUTFIELD test/OneSavepoint.__stackPosition : I
   L6
    LINENUMBER <span style="color:#00D">14</span> L6
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L7
    LINENUMBER <span style="color:#00D">15</span> L7
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L8
    LINENUMBER <span style="color:#00D">16</span> L8
    RETURN
   L0 // <b class="conum">(6)</b>
   FRAME CHOP <span style="color:#00D">2</span>
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.size ()I
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stackPosition : I
    IF_ICMPNE L9
    GOTO L1 // <b class="conum">(7)</b>
   L9
   FRAME SAME
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stackPosition : I
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.get (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    CHECKCAST org/copperengine/core/StackEntry
    GETFIELD org/copperengine/core/StackEntry.jumpNo : I
    DUP
    SIPUSH <span style="color:#00D">0</span>
    IF_ICMPNE L10
    POP
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepoint.__stackPosition : I
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.get (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>; // <b class="conum">(8)</b>
    CHECKCAST org/copperengine/core/StackEntry
    GETFIELD org/copperengine/core/StackEntry.locals : [Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    DUP
    SIPUSH <span style="color:#00D">0</span>
    AALOAD
    CHECKCAST test/OneSavepoint
    ASTORE <span style="color:#00D">0</span>
    DUP
    SIPUSH <span style="color:#00D">1</span>
    AALOAD
    CHECKCAST java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>
    INVOKEVIRTUAL java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.intValue ()I
    ISTORE <span style="color:#00D">1</span>
    DUP
    SIPUSH <span style="color:#00D">2</span>
    AALOAD
    CHECKCAST java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>
    INVOKEVIRTUAL java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.intValue ()I
    ISTORE <span style="color:#00D">2</span>
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepoint.__stackPosition : I
    ICONST_1
    IADD
    PUTFIELD test/OneSavepoint.__stackPosition : I
    GOTO L5 // <b class="conum">(9)</b>
   L10
   FRAME SAME1 I
    NEW java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>
    DUP
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>
    INVOKESPECIAL java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>.&lt;init&gt; (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
    ATHROW
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepoint; L1 L0 <span style="color:#00D">0</span>
    LOCALVARIABLE i1 I L3 L0 <span style="color:#00D">1</span>
    LOCALVARIABLE i2 I L4 L0 <span style="color:#00D">2</span>
    MAXSTACK = <span style="color:#00D">8</span>
    MAXLOCALS = <span style="color:#00D">3</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Goto the end of the method</p>
</li>
<li>
<p>Start of original <code>main</code></p>
</li>
<li>
<p>The <code>savepoint</code></p>
</li>
<li>
<p>Creating the <code>StackEntry</code></p>
</li>
<li>
<p>Continue label after <code>safepoint</code> incl. adjusting <code><em>stack</code> and <code></em>stackPosition</code></p>
</li>
<li>
<p>Behind the original end of method</p>
</li>
<li>
<p>Goto start of original <code>main</code></p>
</li>
<li>
<p>Reading the <code>StackEntry</code></p>
</li>
<li>
<p>Goto continue label after <code>safepoint</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We see, that creating the <code>StackEntry</code> is in the method, behind the <code>savepoint</code>.
Reading the <code>StackEntry</code> ist behind the original end of method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SavepointsAndSubWorkflows">Example with Savepoints and Subworkflows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is a more complex Workflow with several `savepoint`s.</p>
</div>
<div class="sect2">
<h3 id="_the_original_workflow_2">The original Workflow</h3>
<div class="paragraph">
<p>It also has <code>subWorkflow</code>, called in <code>main</code>.
And there is a <code>subWorkflow2</code>, called in <code>subWorkflow</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td>
  <td class="code"><pre><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">test</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Interrupt</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Workflow</span>;

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SavepointsAndSubWorkflows</span> <span style="color:#088;font-weight:bold">extends</span> Workflow&lt;<span style="color:#0a8;font-weight:bold">Void</span>&gt; {

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> main() <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#339;font-weight:bold">int</span> i1 = <span style="color:#00D">1</span>;
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> i2 = <span style="color:#00D">2</span>;
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=1</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=2</span><span style="color:#710">&quot;</span></span>);
        subWorkflow(i1, <span style="color:#00D">666L</span>); // <b class="conum">(1)</b>
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> subWorkflow(<span style="color:#339;font-weight:bold">int</span> i1, <span style="color:#339;font-weight:bold">long</span> l) <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow start</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=1</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=2</span><span style="color:#710">&quot;</span></span>);
        subWorkflow2(<span style="color:#080;font-weight:bold">new</span> <span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span> { <span style="color:#00D">777L</span>, <span style="color:#00D">888L</span>, <span style="color:#00D">999L</span> }); // <b class="conum">(2)</b>
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow end</span><span style="color:#710">&quot;</span></span>);
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> subWorkflow2(<span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span> l) <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow2 start</span><span style="color:#710">&quot;</span></span>);
        savepoint();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow2 end</span><span style="color:#710">&quot;</span></span>);
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Call of <code>subWorkflow</code> with 2 parameters</p>
</li>
<li>
<p>Call of <code>subWorkflows</code> with 1 parameter (array of long)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_the_decompiled_instrumented_workflow_2">The decompiled instrumented Workflow</h3>
<div class="paragraph">
<p>This is the instrumented Workflow with incorrect Java code, generated by a decompiler.
Nevertheless, it helps to understand more of the COPPER internals.</p>
</div>
<div class="paragraph">
<p>We see the handling of SubWorkflows (Interruptable methods).
The parameters are also stored in a <code>StackEntry</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
</pre></td>
  <td class="code"><pre><span style="color:#777">//</span>
<span style="color:#777">// Source code recreated from a .class file by IntelliJ IDEA</span>
<span style="color:#777">// (powered by Fernflower decompiler)</span>
<span style="color:#777">//</span>

<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">test</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Interrupt</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.StackEntry</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Workflow</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.instrument.Transformed</span>;

<span style="color:#007">@Transformed</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">SavepointsAndSubWorkflows</span> <span style="color:#088;font-weight:bold">extends</span> Workflow&lt;<span style="color:#0a8;font-weight:bold">Void</span>&gt; {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> main() <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.__stack.size() == <span style="color:#950">this</span>.__stackPosition) {
            <span style="color:#339;font-weight:bold">int</span> i1 = <span style="color:#00D">1</span>;
            <span style="color:#339;font-weight:bold">int</span> i2 = <span style="color:#00D">2</span>;
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#950">this</span>.savepoint();
            <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">0</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, i2}));
            ++<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
        } <span style="color:#080;font-weight:bold">else</span> {
            <span style="color:#339;font-weight:bold">int</span> var10000 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).jumpNo;
            <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">0</span>) {
                <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var22 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var22[<span style="color:#00D">0</span>];
                <span style="color:#339;font-weight:bold">int</span> var10 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var22[<span style="color:#00D">1</span>];
                <span style="color:#339;font-weight:bold">int</span> var14 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var22[<span style="color:#00D">2</span>];
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
                <span style="color:#950">this</span>.savepoint();
                <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, var10, var14}));
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
            } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">1</span>) {
                <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var21 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var21[<span style="color:#00D">0</span>];
                <span style="color:#339;font-weight:bold">int</span> var9 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var21[<span style="color:#00D">1</span>];
                <span style="color:#339;font-weight:bold">int</span> var13 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var21[<span style="color:#00D">2</span>];
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=1</span><span style="color:#710">&quot;</span></span>);
                <span style="color:#950">this</span>.savepoint();
                <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">2</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, var9, var13}));
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
            } <span style="color:#080;font-weight:bold">else</span> {
                SavepointsAndSubWorkflows var18;
                <span style="color:#339;font-weight:bold">int</span> var23; // <b class="conum">(1)</b>
                <span style="color:#339;font-weight:bold">long</span> var26; // <b class="conum">(2)</b>
                <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">2</span>) {
                    <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var16 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                    <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var16[<span style="color:#00D">0</span>];
                    <span style="color:#339;font-weight:bold">int</span> i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var16[<span style="color:#00D">1</span>];
                    <span style="color:#339;font-weight:bold">int</span> i2 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var16[<span style="color:#00D">2</span>];
                    ++<span style="color:#950">this</span>.__stackPosition;
                    <span style="color:#950">this</span>.__stack.pop();
                    --<span style="color:#950">this</span>.__stackPosition;
                    <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=2</span><span style="color:#710">&quot;</span></span>);
                    <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, <span style="color:#00D">666L</span>}, <span style="color:#00D">3</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, i2})); // <b class="conum">(3)</b>
                    var16 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).stack; // <b class="conum">(4)</b>
                    var18 = (SavepointsAndSubWorkflows)var16[<span style="color:#00D">0</span>]; // <b class="conum">(4)</b>
                    var23 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var16[<span style="color:#00D">1</span>]; // <b class="conum">(4)</b>
                    var26 = (<span style="color:#0a8;font-weight:bold">Long</span>)var16[<span style="color:#00D">2</span>]; // <b class="conum">(4)</b>
                    ++<span style="color:#950">this</span>.__stackPosition; // <b class="conum">(5)</b>
                } <span style="color:#080;font-weight:bold">else</span> { // <b class="conum">(6)</b>
                    <span style="color:#080;font-weight:bold">if</span> (var10000 != <span style="color:#00D">3</span>) {
                        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>);
                    }

                    <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var19 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                    <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var19[<span style="color:#00D">0</span>];
                    <span style="color:#339;font-weight:bold">int</span> var8 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var19[<span style="color:#00D">1</span>];
                    <span style="color:#339;font-weight:bold">int</span> var12 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var19[<span style="color:#00D">2</span>];
                    var19 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).stack; // <b class="conum">(7)</b>
                    var18 = (SavepointsAndSubWorkflows)var19[<span style="color:#00D">0</span>]; // <b class="conum">(7)</b>
                    var23 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var19[<span style="color:#00D">1</span>]; // <b class="conum">(7)</b>
                    var26 = (<span style="color:#0a8;font-weight:bold">Long</span>)var19[<span style="color:#00D">2</span>]; // <b class="conum">(7)</b>
                    ++<span style="color:#950">this</span>.__stackPosition; // <b class="conum">(8)</b>
                }

                <span style="color:#080;font-weight:bold">try</span> {
                    var18.subWorkflow(var23, var26); // <b class="conum">(9)</b>
                } <span style="color:#080;font-weight:bold">catch</span> (Interrupt var3) { // <b class="conum">(10)</b>
                    <span style="color:#080;font-weight:bold">throw</span> var3; // <b class="conum">(10)</b>
                } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#0a8;font-weight:bold">Throwable</span> var4) { // <b class="conum">(10)</b>
                    <span style="color:#950">this</span>.__stack.pop(); // <b class="conum">(10)</b>
                    --<span style="color:#950">this</span>.__stackPosition; // <b class="conum">(10)</b>
                    <span style="color:#080;font-weight:bold">throw</span> var4; // <b class="conum">(10)</b>
                } // <b class="conum">(10)</b>

                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>);
            }
        }
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> subWorkflow(<span style="color:#339;font-weight:bold">int</span> i1, <span style="color:#339;font-weight:bold">long</span> l) <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.__stack.size() == <span style="color:#950">this</span>.__stackPosition) {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow start</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#950">this</span>.savepoint();
            <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">0</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, l, <span style="color:#069">null</span>}));
            ++<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
        } <span style="color:#080;font-weight:bold">else</span> {
            <span style="color:#339;font-weight:bold">int</span> var10000 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).jumpNo;
            <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">0</span>) {
                <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var23 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var23[<span style="color:#00D">0</span>];
                i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var23[<span style="color:#00D">1</span>];
                l = (<span style="color:#0a8;font-weight:bold">Long</span>)var23[<span style="color:#00D">2</span>];
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
                <span style="color:#950">this</span>.savepoint();
                <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, l, <span style="color:#069">null</span>}));
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
            } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">1</span>) {
                <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var22 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var22[<span style="color:#00D">0</span>];
                i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var22[<span style="color:#00D">1</span>];
                l = (<span style="color:#0a8;font-weight:bold">Long</span>)var22[<span style="color:#00D">2</span>];
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=1</span><span style="color:#710">&quot;</span></span>);
                <span style="color:#950">this</span>.savepoint();
                <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">2</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, l, <span style="color:#069">null</span>}));
                ++<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
            } <span style="color:#080;font-weight:bold">else</span> {
                SavepointsAndSubWorkflows var19;
                <span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span> var24;
                <span style="color:#080;font-weight:bold">if</span> (var10000 == <span style="color:#00D">2</span>) {
                    <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var17 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                    <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var17[<span style="color:#00D">0</span>];
                    i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var17[<span style="color:#00D">1</span>];
                    l = (<span style="color:#0a8;font-weight:bold">Long</span>)var17[<span style="color:#00D">2</span>];
                    ++<span style="color:#950">this</span>.__stackPosition;
                    <span style="color:#950">this</span>.__stack.pop();
                    --<span style="color:#950">this</span>.__stackPosition;
                    <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=2</span><span style="color:#710">&quot;</span></span>);
                    <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#00D">777L</span>, <span style="color:#00D">888L</span>, <span style="color:#00D">999L</span>}}, <span style="color:#00D">3</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, i1, l, <span style="color:#069">null</span>}));
                    var17 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).stack;
                    var19 = (SavepointsAndSubWorkflows)var17[<span style="color:#00D">0</span>];
                    var24 = (<span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span>)var17[<span style="color:#00D">1</span>];
                    ++<span style="color:#950">this</span>.__stackPosition;
                } <span style="color:#080;font-weight:bold">else</span> {
                    <span style="color:#080;font-weight:bold">if</span> (var10000 != <span style="color:#00D">3</span>) {
                        <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>);
                    }

                    <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var20 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
                    <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var20[<span style="color:#00D">0</span>];
                    i1 = (<span style="color:#0a8;font-weight:bold">Integer</span>)var20[<span style="color:#00D">1</span>];
                    l = (<span style="color:#0a8;font-weight:bold">Long</span>)var20[<span style="color:#00D">2</span>];
                    var20 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).stack;
                    var19 = (SavepointsAndSubWorkflows)var20[<span style="color:#00D">0</span>];
                    var24 = (<span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span>)var20[<span style="color:#00D">1</span>];
                    ++<span style="color:#950">this</span>.__stackPosition;
                }

                <span style="color:#080;font-weight:bold">try</span> {
                    var19.subWorkflow2(var24);
                } <span style="color:#080;font-weight:bold">catch</span> (Interrupt var4) {
                    <span style="color:#080;font-weight:bold">throw</span> var4;
                } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#0a8;font-weight:bold">Throwable</span> var5) {
                    <span style="color:#950">this</span>.__stack.pop();
                    --<span style="color:#950">this</span>.__stackPosition;
                    <span style="color:#080;font-weight:bold">throw</span> var5;
                }

                <span style="color:#950">this</span>.__stack.pop();
                --<span style="color:#950">this</span>.__stackPosition;
                <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow end</span><span style="color:#710">&quot;</span></span>);
            }
        }
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> subWorkflow2(<span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span> l) <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#080;font-weight:bold">if</span> (<span style="color:#950">this</span>.__stack.size() == <span style="color:#950">this</span>.__stackPosition) {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow2 start</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#950">this</span>.savepoint();
            <span style="color:#950">this</span>.__stack.push(<span style="color:#080;font-weight:bold">new</span> StackEntry(<span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span>[<span style="color:#00D">0</span>], <span style="color:#00D">0</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>{<span style="color:#950">this</span>, l}));
            ++<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> Interrupt();
        } <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">if</span> (((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).jumpNo == <span style="color:#00D">0</span>) {
            <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> var10000 = ((StackEntry)<span style="color:#950">this</span>.__stack.get(<span style="color:#950">this</span>.__stackPosition)).locals;
            <span style="color:#950">this</span> = (SavepointsAndSubWorkflows)var10000[<span style="color:#00D">0</span>];
            l = (<span style="color:#339;font-weight:bold">long</span><span style="color:#339;font-weight:bold">[]</span>)var10000[<span style="color:#00D">1</span>];
            ++<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#950">this</span>.__stack.pop();
            --<span style="color:#950">this</span>.__stackPosition;
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subWorklow2 end</span><span style="color:#710">&quot;</span></span>);
        } <span style="color:#080;font-weight:bold">else</span> {
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>);
        }
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Variable used as parameter for the <code>subWorkflow</code></p>
</li>
<li>
<p>Variable used as parameter for the <code>subWorkflow</code></p>
</li>
<li>
<p>Create <code>StackEntry</code> with <code>jumpNo=3</code> incl. <code>stack</code> with parameters</p>
</li>
<li>
<p>Prepare variables used as parameter before 1st call of <code>subWorkflow</code></p>
</li>
<li>
<p>Increment <code>__stackPosition</code> before calling <code>subWorkflow</code></p>
</li>
<li>
<p>Condition for <code>jumpNo=3</code> to call <code>subWorkflow</code></p>
</li>
<li>
<p>Prepare variables used as parameter before other calls of <code>subWorkflow</code></p>
</li>
<li>
<p>Increment <code>__stackPosition</code> before calling <code>subWorkflow</code></p>
</li>
<li>
<p>Call of <code>subWorkflow</code></p>
</li>
<li>
<p>Instrumented handling for <code>Interrupt</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>subWorkflow2</code> is added for analyzing deeper call structures.</p>
</div>
<div class="paragraph">
<p>The concept for the implementation of continuations in COPPER should be cleared now.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Implementation">Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter we step deeper into the implementation.
It contains several links into the source code repository, where you might start more analysis.
We start with more information about <code>Interrupt</code>.</p>
</div>
<div class="sect2">
<h3 id="_interrupt">Interrupt</h3>
<div class="paragraph">
<p>We saw, that throwing an <code>Interrupt</code> is the was to end a continuation before it will be resumed later.
To avoid unexpected side effects in try, catch and finally handling must be instrumented.
In the last example it was visible in the decompiled Workflow.</p>
</div>
<div class="paragraph">
<p>The major responsible class for this aspect is the <a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/instrument/TryCatchBlockHandler.java"><code>TryCatchBlockHandler</code></a></p>
</div>
<div class="paragraph">
<p><code>Interrupt</code> throwable must not be handled or thrown.
Catching it, leads to an exception.
Creating it, leads to a warning.</p>
</div>
</div>
<div class="sect2">
<h3 id="_workflow">Workflow</h3>
<div class="paragraph">
<p>The class
<a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/Workflow.java"><code>Workflow</code></a>
holds the above-mentioned <code>__stack</code> and <code>__stackPosition</code> and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> __beforeProcess() {
        __stackPosition = <span style="color:#00D">0</span>;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Analysing the <code>transient</code> members might be interesting</p>
</div>
</div>
<div class="sect2">
<h3 id="_engine">Engine</h3>
<div class="paragraph">
<p>COPPER offers two engines, which control and store the continuation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/persistent/PersistentScottyEngine.java#L232">Persistent engine stores <code>Workflow</code> in a DB (see dbStorage.insert)</a></p>
</li>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/tranzient/TransientScottyEngine.java#L182">Transient engine stores <code>Workflow</code> in memory (see workflowMap.put)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_workflowrepository">WorkflowRepository</h3>
<div class="paragraph">
<p>The
<a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/wfrepo/AbstractWorkflowRepository.java#L211">AbstractWorkflowRepository</a>
controls the instrumentation using the major classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/instrument/TryCatchBlockHandler.java"><code>TryCatchBlockHandler</code></a>
we already discussed above</p>
</li>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/instrument/ScottyClassAdapter.java"><code>ScottyClassAdapter</code></a>
connecting [<code>ScottyMethodAdapter</code>] and [<code>BuildStackInfoAdapter</code>]</p>
</li>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/instrument/ScottyMethodAdapter.java"><code>ScottyMethodAdapter</code></a>
implementing major methods <code>visitMethodInsn</code> and <code>visitEnd</code></p>
</li>
<li>
<p><a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-coreengine/src/main/java/org/copperengine/core/instrument/BuildStackInfoAdapter.java"><code>BuildStackInfoAdapter</code></a>
keeping track of type information in <code>StackEntry</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_last_workflow">Last Workflow</h4>
<div class="paragraph">
<p>The last Workflow we analyze has one <code>savepoint</code> and a try, catch, finally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td>
  <td class="code"><pre><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">test</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Interrupt</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.copperengine.core.Workflow</span>;

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">OneSavepointWithTryCatchFinally</span> <span style="color:#088;font-weight:bold">extends</span> Workflow&lt;<span style="color:#0a8;font-weight:bold">Void</span>&gt; {

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> main() <span style="color:#088;font-weight:bold">throws</span> Interrupt {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#080;font-weight:bold">try</span> {
            <span style="color:#339;font-weight:bold">int</span> i1 = <span style="color:#00D">1</span>;
            <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">int</span> i2 = <span style="color:#00D">2</span>;
            savepoint(); // <b class="conum">(1)</b>
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>);
        } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">Exception</span> e) {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Exception</span><span style="color:#710">&quot;</span></span>);
            <span style="color:#080;font-weight:bold">throw</span> <span style="color:#080;font-weight:bold">new</span> <span style="color:#C00;font-weight:bold">RuntimeException</span>(e);
        } <span style="color:#080;font-weight:bold">finally</span> {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finally</span><span style="color:#710">&quot;</span></span>);
        }
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>);
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_byte_code_of_the_instrumented_workflow_with_trace">The byte code of the instrumented Workflow with trace</h4>
<div class="paragraph">
<p>To analyze the responsibilities for instrumentation, we look at the instrumented Workflow with trace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
</pre></td>
  <td class="code"><pre><span style="color:#777">// class version 61.0 (61)</span>
<span style="color:#777">// access flags 0x21</span>
<span style="color:#777">// signature Lorg/copperengine/core/Workflow&lt;Ljava/lang/Void;&gt;;</span>
<span style="color:#777">// declaration: test/OneSavepointWithTryCatchFinally extends org.copperengine.core.Workflow&lt;java.lang.Void&gt;</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">test</span>/OneSavepointWithTryCatchFinally <span style="color:#088;font-weight:bold">extends</span> org/copperengine/core/Workflow {

  <span style="color:#777">// compiled from: OneSavepointWithTryCatchFinally.java</span>

  <span style="color:#007">@Lorg</span>/copperengine/core/instrument/Transformed;()

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> &lt;init&gt;()V
   L0
    LINENUMBER <span style="color:#00D">21</span> L0
    ALOAD <span style="color:#00D">0</span>
    INVOKESPECIAL org/copperengine/core/Workflow.&lt;init&gt; ()V
    RETURN
   L1
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepointWithTryCatchFinally; L0 L1 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">1</span>
    MAXLOCALS = <span style="color:#00D">1</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> main()V <span style="color:#088;font-weight:bold">throws</span> org/copperengine/core/Interrupt
    TRYCATCHBLOCK L0 L1 L2 java/lang/<span style="color:#C00;font-weight:bold">Exception</span>
    TRYCATCHBLOCK L0 L1 L3 <span style="color:#069">null</span>
    TRYCATCHBLOCK L2 L4 L3 <span style="color:#069">null</span>
    GOTO L5
   L6
    LINENUMBER <span style="color:#00D">25</span> L6
   FRAME SAME
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L0
    LINENUMBER <span style="color:#00D">27</span> L0
    ICONST_1
    ISTORE <span style="color:#00D">1</span>
   L7
    LINENUMBER <span style="color:#00D">28</span> L7
    ICONST_2
    ISTORE <span style="color:#00D">2</span>
   L8
    LINENUMBER <span style="color:#00D">29</span> L8
    ALOAD <span style="color:#00D">0</span>
    INVOKEVIRTUAL test/OneSavepointWithTryCatchFinally.savepoint ()V
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Start instrumentation waitMethods in visitMethodInsn (savepoint)</span><span style="color:#710">&quot;</span></span> // <b class="conum">(1)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    SIPUSH <span style="color:#00D">0</span>
    ANEWARRAY java/lang/<span style="color:#0a8;font-weight:bold">Object</span>
    NEW org/copperengine/core/StackEntry
    DUP_X1
    DUP_X1
    POP
    SIPUSH <span style="color:#00D">0</span>
    SIPUSH <span style="color:#00D">3</span>
    ANEWARRAY java/lang/<span style="color:#0a8;font-weight:bold">Object</span>
    DUP
    SIPUSH <span style="color:#00D">0</span>
    ALOAD <span style="color:#00D">0</span>
    AASTORE
    DUP
    SIPUSH <span style="color:#00D">1</span>
    ILOAD <span style="color:#00D">1</span>
    INVOKESTATIC java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.valueOf (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Integer</span>;
    AASTORE
    DUP
    SIPUSH <span style="color:#00D">2</span>
    ILOAD <span style="color:#00D">2</span>
    INVOKESTATIC java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.valueOf (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Integer</span>;
    AASTORE
    INVOKESPECIAL org/copperengine/core/StackEntry.&lt;init&gt; ([Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;I[Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;)V
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    SWAP
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.push (Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    ICONST_1
    IADD
    PUTFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    NEW org/copperengine/core/Interrupt
    DUP
    INVOKESPECIAL org/copperengine/core/Interrupt.&lt;init&gt; ()V
    ATHROW
   L9
   FRAME APPEND [I I]
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.pop ()Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    ICONST_1
    ISUB
    PUTFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">End instrumentation waitMethods in visitMethodInsn (savepoint)</span><span style="color:#710">&quot;</span></span> // <b class="conum">(2)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
   L10
    LINENUMBER <span style="color:#00D">30</span> L10
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L1
    LINENUMBER <span style="color:#00D">35</span> L1
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finally</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L11
    LINENUMBER <span style="color:#00D">36</span> L11
    GOTO L12
   L2
    LINENUMBER <span style="color:#00D">31</span> L2
   FRAME FULL [test/OneSavepointWithTryCatchFinally] [java/lang/<span style="color:#C00;font-weight:bold">Exception</span>]
    ASTORE <span style="color:#00D">1</span>
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Start instrumentation tryCatchBlock</span><span style="color:#710">&quot;</span></span> // <b class="conum">(3)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    ALOAD <span style="color:#00D">1</span>
    INSTANCEOF org/copperengine/core/Interrupt
    IFEQ L13
    ALOAD <span style="color:#00D">1</span>
    CHECKCAST org/copperengine/core/Interrupt
    ATHROW
   L13
   FRAME APPEND [java/lang/<span style="color:#C00;font-weight:bold">Exception</span>]
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">End instrumentation tryCatchBlock</span><span style="color:#710">&quot;</span></span> // <b class="conum">(4)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
   L14
    LINENUMBER <span style="color:#00D">32</span> L14
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Exception</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L15
    LINENUMBER <span style="color:#00D">33</span> L15
    NEW java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>
    DUP
    ALOAD <span style="color:#00D">1</span>
    INVOKESPECIAL java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>.&lt;init&gt; (Ljava/lang/<span style="color:#0a8;font-weight:bold">Throwable</span>;)V
    ATHROW
   L3
    LINENUMBER <span style="color:#00D">35</span> L3
   FRAME FULL [test/OneSavepointWithTryCatchFinally] [java/lang/<span style="color:#0a8;font-weight:bold">Throwable</span>]
    ASTORE <span style="color:#00D">3</span>
   L4
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Start instrumentation tryCatchBlock</span><span style="color:#710">&quot;</span></span> // <b class="conum">(5)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    ALOAD <span style="color:#00D">3</span>
    INSTANCEOF org/copperengine/core/Interrupt
    IFEQ L16
    ALOAD <span style="color:#00D">3</span>
    CHECKCAST org/copperengine/core/Interrupt
    ATHROW
   L16
   FRAME APPEND [T T java/lang/<span style="color:#0a8;font-weight:bold">Throwable</span>]
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">End instrumentation tryCatchBlock</span><span style="color:#710">&quot;</span></span> // <b class="conum">(6)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finally</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L17
    LINENUMBER <span style="color:#00D">36</span> L17
    ALOAD <span style="color:#00D">3</span>
    ATHROW
   L12
    LINENUMBER <span style="color:#00D">37</span> L12
   FRAME FULL [test/OneSavepointWithTryCatchFinally I I] <span style="color:#339;font-weight:bold">[]</span>
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L18
    LINENUMBER <span style="color:#00D">38</span> L18
    RETURN
   L5
   FRAME CHOP <span style="color:#00D">2</span>
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Start instrumentation in visitEnd</span><span style="color:#710">&quot;</span></span> // <b class="conum">(7)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.size ()I
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    IF_ICMPNE L19
    GOTO L6
   L19
   FRAME SAME
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.get (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    CHECKCAST org/copperengine/core/StackEntry
    GETFIELD org/copperengine/core/StackEntry.jumpNo : I
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Inside instrumentation in visitEnd</span><span style="color:#710">&quot;</span></span> // <b class="conum">(8)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    DUP
    SIPUSH <span style="color:#00D">0</span>
    IF_ICMPNE L20
    POP
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stack : Ljava/util/<span style="color:#0a8;font-weight:bold">Stack</span>;
    ALOAD <span style="color:#00D">0</span>
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    INVOKEVIRTUAL java/util/<span style="color:#0a8;font-weight:bold">Stack</span>.get (I)Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    CHECKCAST org/copperengine/core/StackEntry
    GETFIELD org/copperengine/core/StackEntry.locals : [Ljava/lang/<span style="color:#0a8;font-weight:bold">Object</span>;
    DUP
    SIPUSH <span style="color:#00D">0</span>
    AALOAD
    CHECKCAST test/OneSavepointWithTryCatchFinally
    ASTORE <span style="color:#00D">0</span>
    DUP
    SIPUSH <span style="color:#00D">1</span>
    AALOAD
    CHECKCAST java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>
    INVOKEVIRTUAL java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.intValue ()I
    ISTORE <span style="color:#00D">1</span>
    DUP
    SIPUSH <span style="color:#00D">2</span>
    AALOAD
    CHECKCAST java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>
    INVOKEVIRTUAL java/lang/<span style="color:#0a8;font-weight:bold">Integer</span>.intValue ()I
    ISTORE <span style="color:#00D">2</span>
    POP
    ALOAD <span style="color:#00D">0</span>
    DUP
    GETFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    ICONST_1
    IADD
    PUTFIELD test/OneSavepointWithTryCatchFinally.__stackPosition : I
    GOTO L9
   L20
   FRAME SAME1 I
    GETSTATIC org/copperengine/core/Workflow.logger : Lorg/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">End instrumentation in visitEnd</span><span style="color:#710">&quot;</span></span> // <b class="conum">(9)</b>
    INVOKEINTERFACE org/slf4j/<span style="color:#0a8;font-weight:bold">Logger</span>.trace (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V (itf)
    NEW java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>
    DUP
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">No such label</span><span style="color:#710">&quot;</span></span>
    INVOKESPECIAL java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>.&lt;init&gt; (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
    ATHROW
    LOCALVARIABLE i1 I L7 L1 <span style="color:#00D">1</span>
    LOCALVARIABLE i2 I L8 L1 <span style="color:#00D">2</span>
    LOCALVARIABLE e Ljava/lang/<span style="color:#C00;font-weight:bold">Exception</span>; L14 L3 <span style="color:#00D">1</span>
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepointWithTryCatchFinally; L6 L5 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">8</span>
    MAXLOCALS = <span style="color:#00D">4</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Start <code>ScottyMethodAdapter.visitMethodInsn</code></p>
</li>
<li>
<p>End <code>ScottyMethodAdapter.visitMethodInsn</code></p>
</li>
<li>
<p>Start <code>TryCatchBlockHandler.instrument</code></p>
</li>
<li>
<p>End <code>TryCatchBlockHandler.instrument</code></p>
</li>
<li>
<p>Start <code>TryCatchBlockHandler.instrument</code></p>
</li>
<li>
<p>End <code>TryCatchBlockHandler.instrument</code></p>
</li>
<li>
<p>Start <code>ScottyMethodAdapter.visitEnd</code></p>
</li>
<li>
<p>Inside <code>ScottyMethodAdapter.visitEnd</code></p>
</li>
<li>
<p>End <code>ScottyMethodAdapter.visitEnd</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_the_byte_code_of_the_instrumented_workflow_with_trace_2">The byte code of the instrumented Workflow with trace</h4>
<div class="paragraph">
<p>You might have noticed the two sequences for <code>finally</code>.
These already existed in the not instrumented byte code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre></td>
  <td class="code"><pre><span style="color:#777">// class version 61.0 (61)</span>
<span style="color:#777">// access flags 0x21</span>
<span style="color:#777">// signature Lorg/copperengine/core/Workflow&lt;Ljava/lang/Void;&gt;;</span>
<span style="color:#777">// declaration: test/OneSavepointWithTryCatchFinally extends org.copperengine.core.Workflow&lt;java.lang.Void&gt;</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">test</span>/OneSavepointWithTryCatchFinally <span style="color:#088;font-weight:bold">extends</span> org/copperengine/core/Workflow {

  <span style="color:#777">// compiled from: OneSavepointWithTryCatchFinally.java</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> &lt;init&gt;()V
   L0
    LINENUMBER <span style="color:#00D">21</span> L0
    ALOAD <span style="color:#00D">0</span>
    INVOKESPECIAL org/copperengine/core/Workflow.&lt;init&gt; ()V
    RETURN
   L1
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepointWithTryCatchFinally; L0 L1 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">1</span>
    MAXLOCALS = <span style="color:#00D">1</span>

  <span style="color:#777">// access flags 0x1</span>
  <span style="color:#088;font-weight:bold">public</span> main()V <span style="color:#088;font-weight:bold">throws</span> org/copperengine/core/Interrupt
    TRYCATCHBLOCK L0 L1 L2 java/lang/<span style="color:#C00;font-weight:bold">Exception</span>
    TRYCATCHBLOCK L0 L1 L3 <span style="color:#069">null</span>
    TRYCATCHBLOCK L2 L4 L3 <span style="color:#069">null</span>
   L5
    LINENUMBER <span style="color:#00D">25</span> L5
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main start</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L0
    LINENUMBER <span style="color:#00D">27</span> L0
    ICONST_1
    ISTORE <span style="color:#00D">1</span>
   L6
    LINENUMBER <span style="color:#00D">28</span> L6
    ICONST_2
    ISTORE <span style="color:#00D">2</span>
   L7
    LINENUMBER <span style="color:#00D">29</span> L7
    ALOAD <span style="color:#00D">0</span>
    INVOKEVIRTUAL test/OneSavepointWithTryCatchFinally.savepoint ()V
   L8
    LINENUMBER <span style="color:#00D">30</span> L8
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jumpNo=0</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L1
    LINENUMBER <span style="color:#00D">35</span> L1
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finally</span><span style="color:#710">&quot;</span></span> // <b class="conum">(1)</b>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L9
    LINENUMBER <span style="color:#00D">36</span> L9
    GOTO L10
   L2
    LINENUMBER <span style="color:#00D">31</span> L2
   FRAME SAME1 java/lang/<span style="color:#C00;font-weight:bold">Exception</span>
    ASTORE <span style="color:#00D">1</span>
   L11
    LINENUMBER <span style="color:#00D">32</span> L11
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Exception</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L12
    LINENUMBER <span style="color:#00D">33</span> L12
    NEW java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>
    DUP
    ALOAD <span style="color:#00D">1</span>
    INVOKESPECIAL java/lang/<span style="color:#C00;font-weight:bold">RuntimeException</span>.&lt;init&gt; (Ljava/lang/<span style="color:#0a8;font-weight:bold">Throwable</span>;)V
    ATHROW
   L3
    LINENUMBER <span style="color:#00D">35</span> L3
   FRAME SAME1 java/lang/<span style="color:#0a8;font-weight:bold">Throwable</span>
    ASTORE <span style="color:#00D">3</span>
   L4
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Finally</span><span style="color:#710">&quot;</span></span> // <b class="conum">(2)</b>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L13
    LINENUMBER <span style="color:#00D">36</span> L13
    ALOAD <span style="color:#00D">3</span>
    ATHROW
   L10
    LINENUMBER <span style="color:#00D">37</span> L10
   FRAME SAME
    GETSTATIC java/lang/<span style="color:#0a8;font-weight:bold">System</span>.out : Ljava/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>;
    LDC <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">main end</span><span style="color:#710">&quot;</span></span>
    INVOKEVIRTUAL java/io/<span style="color:#0a8;font-weight:bold">PrintStream</span>.println (Ljava/lang/<span style="color:#0a8;font-weight:bold">String</span>;)V
   L14
    LINENUMBER <span style="color:#00D">38</span> L14
    RETURN
   L15
    LOCALVARIABLE i1 I L6 L1 <span style="color:#00D">1</span>
    LOCALVARIABLE i2 I L7 L1 <span style="color:#00D">2</span>
    LOCALVARIABLE e Ljava/lang/<span style="color:#C00;font-weight:bold">Exception</span>; L11 L3 <span style="color:#00D">1</span>
    LOCALVARIABLE <span style="color:#950">this</span> Ltest/OneSavepointWithTryCatchFinally; L5 L15 <span style="color:#00D">0</span>
    MAXSTACK = <span style="color:#00D">3</span>
    MAXLOCALS = <span style="color:#00D">4</span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>1st finally sequence</p>
</li>
<li>
<p>2nd finally sequence</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_analysetest">AnalyseTest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One test, that shows some internal is the
<a href="https://github.com/copper-engine/copper-engine/blob/master/projects/copper-regtest/src/test/java/org/copperengine/regtest/test/analyse/AnalyseTest.java"><code>AnalyseTest</code></a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2026-01-05 11:56:11 +0100
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
        (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>